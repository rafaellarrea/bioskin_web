<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Test Visual - Sistema de Im√°genes y Mejoras de Blog</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #deb887; 
            text-align: center; 
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .test-section { 
            margin-bottom: 30px; 
            padding: 20px; 
            background: #f8f9fa; 
            border-radius: 10px;
            border-left: 5px solid #deb887;
        }
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
        }
        button { 
            background: #deb887; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        button:hover { 
            background: #c9a677; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .warning { color: #f59e0b; font-weight: bold; }
        .info { color: #3b82f6; }
        #log-container { 
            background: #1f2937; 
            color: #f9fafb; 
            padding: 20px; 
            border-radius: 10px; 
            max-height: 500px; 
            overflow-y: auto;
            font-family: 'Courier New', monospace;
        }
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        .image-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: white;
            max-width: 300px;
        }
        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .blog-preview {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: white;
            margin-top: 15px;
        }
        .blog-preview h3 {
            color: #deb887;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® Test Visual - Mejoras de Blog BIOSKIN</h1>
        
        <div class="test-section">
            <h2>üñºÔ∏è Sistema de Im√°genes</h2>
            <p>Prueba el nuevo sistema de im√°genes desde Unsplash que se asignan autom√°ticamente seg√∫n el contenido.</p>
            <button onclick="testImageGeneration()">üîç Probar Generaci√≥n de Im√°genes</button>
            <button onclick="testCategoryImages()">üìÇ Probar Im√°genes por Categor√≠a</button>
            <div id="image-results" class="image-preview"></div>
        </div>

        <div class="test-section">
            <h2>üìù Generaci√≥n y Formato de Blogs</h2>
            <p>Genera un blog completo con el nuevo formato y im√°genes autom√°ticas.</p>
            <button onclick="generateFormattedBlog('medico-estetico')">üíä Blog M√©dico-Est√©tico</button>
            <button onclick="generateFormattedBlog('tecnico')">‚ö° Blog T√©cnico</button>
            <div id="blog-results" class="blog-preview" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Test Completo del Flujo</h2>
            <p>Ejecuta un test completo: generaci√≥n ‚Üí imagen ‚Üí formato ‚Üí visibilidad.</p>
            <button onclick="runCompleteVisualTest()">üöÄ Test Completo Visual</button>
            <button onclick="checkPublicBlogs()">üëÄ Ver Blogs P√∫blicos</button>
        </div>

        <div id="log-container">
            <h3 style="color: #deb887; margin-top: 0;">üìã Log de Pruebas</h3>
            <div id="log"></div>
        </div>
    </div>

    <script>
        const baseUrl = window.location.origin;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Test de generaci√≥n de im√°genes
        async function testImageGeneration() {
            log('üñºÔ∏è Probando generaci√≥n de im√°genes...', 'info');
            
            const testCases = [
                { title: 'Hidrataci√≥n Facial Profunda con √Åcido Hialur√≥nico', category: 'medico-estetico' },
                { title: 'Tecnolog√≠a IPL para Tratamiento de Manchas', category: 'tecnico' },
                { title: 'Exosomas en Medicina Regenerativa', category: 'medico-estetico' },
                { title: 'Calibraci√≥n de Equipos HIFU', category: 'tecnico' }
            ];

            const imagesDiv = document.getElementById('image-results');
            imagesDiv.innerHTML = '';

            for (const testCase of testCases) {
                try {
                    // Simular generaci√≥n de imagen (usando el servicio que creamos)
                    const imageUrl = generateImageForBlog(testCase);
                    
                    const imageCard = document.createElement('div');
                    imageCard.className = 'image-card';
                    imageCard.innerHTML = `
                        <img src="${imageUrl}" alt="${testCase.title}" onerror="this.src='/images/logo/logo1.jpg'">
                        <strong>${testCase.category}</strong><br>
                        <small>${testCase.title.substring(0, 40)}...</small>
                    `;
                    imagesDiv.appendChild(imageCard);
                    
                    log(`‚úÖ Imagen generada para: ${testCase.title}`, 'success');
                } catch (error) {
                    log(`‚ùå Error generando imagen: ${error.message}`, 'error');
                }
            }
        }

        // Funci√≥n para generar URL de imagen (simulando el servicio)
        function generateImageForBlog(blog) {
            const medicalPhotos = [
                'https://images.unsplash.com/photo-1559757148-5c350e0a9c6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80',
                'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80',
                'https://images.unsplash.com/photo-1559757175-070c741b80eb?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80',
                'https://images.unsplash.com/photo-1585652906653-f7d564bc68c2?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80'
            ];
            
            return medicalPhotos[Math.floor(Math.random() * medicalPhotos.length)];
        }

        // Test de im√°genes por categor√≠a
        async function testCategoryImages() {
            log('üìÇ Probando im√°genes por categor√≠a...', 'info');
            
            const categories = ['medico-estetico', 'tecnico'];
            const imagesDiv = document.getElementById('image-results');
            imagesDiv.innerHTML = '<h4>Im√°genes por Categor√≠a:</h4>';

            categories.forEach(category => {
                const imageUrl = generateImageForBlog({ category });
                const imageCard = document.createElement('div');
                imageCard.className = 'image-card';
                imageCard.innerHTML = `
                    <img src="${imageUrl}" alt="Categor√≠a ${category}">
                    <strong>Categor√≠a: ${category}</strong><br>
                    <small>Imagen optimizada para esta categor√≠a</small>
                `;
                imagesDiv.appendChild(imageCard);
                log(`‚úÖ Imagen de categor√≠a generada: ${category}`, 'success');
            });
        }

        // Test de generaci√≥n de blog completo
        async function generateFormattedBlog(category) {
            log(`üìù Generando blog de categor√≠a: ${category}...`, 'info');
            
            try {
                const response = await fetch(`${baseUrl}/api/ai-blog/generate-production`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        blogType: category,
                        topic: category === 'medico-estetico' 
                            ? 'Beneficios del tratamiento con plasma rico en plaquetas'
                            : 'Innovaciones en tecnolog√≠a l√°ser para medicina est√©tica'
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    log(`‚úÖ Blog generado exitosamente: ${result.blog.title}`, 'success');
                    log(`üñºÔ∏è Imagen asignada: ${result.blog.image ? 'S√≠' : 'No'}`, 'info');
                    log(`üìä Palabras: ${result.meta?.wordCount || 'N/A'}`, 'info');
                    
                    // Mostrar preview del blog
                    showBlogPreview(result.blog);
                } else {
                    log(`‚ùå Error generando blog: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error en la solicitud: ${error.message}`, 'error');
            }
        }

        // Mostrar preview del blog
        function showBlogPreview(blog) {
            const blogDiv = document.getElementById('blog-results');
            blogDiv.style.display = 'block';
            blogDiv.innerHTML = `
                <h3>${blog.title}</h3>
                <div style="display: flex; gap: 20px; align-items: start;">
                    <img src="${blog.image}" alt="${blog.title}" 
                         style="width: 200px; height: 120px; object-fit: cover; border-radius: 8px;"
                         onerror="this.src='/images/logo/logo1.jpg'">
                    <div>
                        <p><strong>Categor√≠a:</strong> ${blog.category}</p>
                        <p><strong>Autor:</strong> ${blog.author}</p>
                        <p><strong>Tiempo de lectura:</strong> ${blog.readTime || blog.read_time} min</p>
                        <p><strong>Extracto:</strong> ${blog.excerpt?.substring(0, 150)}...</p>
                        <p><strong>Slug:</strong> ${blog.slug}</p>
                    </div>
                </div>
            `;
        }

        // Test completo visual
        async function runCompleteVisualTest() {
            log('üöÄ Iniciando test completo visual...', 'info');
            log('='.repeat(50), 'info');
            
            // 1. Generar blog
            await generateFormattedBlog('medico-estetico');
            
            // 2. Esperar un momento
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // 3. Verificar blogs p√∫blicos
            await checkPublicBlogs();
            
            log('='.repeat(50), 'info');
            log('‚úÖ Test completo visual finalizado', 'success');
        }

        // Verificar blogs p√∫blicos
        async function checkPublicBlogs() {
            log('üëÄ Verificando blogs en p√°gina p√∫blica...', 'info');
            
            try {
                const response = await fetch(`${baseUrl}/api/blogs/manage?limit=5`);
                const data = await response.json();
                
                if (data.success && data.blogs) {
                    log(`‚úÖ Encontrados ${data.blogs.length} blogs p√∫blicos`, 'success');
                    
                    data.blogs.forEach((blog, index) => {
                        log(`üìÑ ${index + 1}. ${blog.title}`, 'info');
                        log(`   üè∑Ô∏è Categor√≠a: ${blog.category}`, 'info');
                        log(`   üñºÔ∏è Imagen: ${blog.image ? 'S√≠' : 'No'}`, blog.image ? 'success' : 'warning');
                        log(`   üìÖ Fecha: ${blog.publishedAt}`, 'info');
                    });
                } else {
                    log('‚ùå No se pudieron obtener los blogs p√∫blicos', 'error');
                }
            } catch (error) {
                log(`‚ùå Error verificando blogs p√∫blicos: ${error.message}`, 'error');
            }
        }

        // Inicializaci√≥n
        log('üé® Sistema de test visual iniciado', 'success');
        log('üëÜ Usa los botones para probar las nuevas caracter√≠sticas', 'info');
    </script>
</body>
</html>